<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>API料金シミュレーター</title>
  <style>
    :root{
      --cream: #fbf4df;
      --ink: #1e1f22;
      --muted: #646a73;
      --card: rgba(255,255,255,.78);
      --card2: rgba(255,255,255,.58);
      --border: rgba(30,31,34,.12);
      --shadow: 0 12px 30px rgba(30,31,34,.12);
      --shadow2: 0 8px 18px rgba(30,31,34,.10);
      --radius: 18px;
      --radius2: 14px;
      --accent: #2f6feb;
      --accent2: #7c3aed;
    }

    *{ box-sizing: border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", Meiryo, sans-serif;
      color: var(--ink);
      background:
        radial-gradient(1200px 500px at 10% 0%, rgba(47,111,235,.14), transparent 55%),
        radial-gradient(900px 500px at 90% 10%, rgba(124,58,237,.12), transparent 55%),
        radial-gradient(900px 520px at 70% 90%, rgba(47,111,235,.10), transparent 60%),
        var(--cream);
      min-height: 100vh;
    }

    .wrap{
      max-width: 1120px;
      margin: 0 auto;
      padding: 28px 18px 42px;
    }

    header{
      display:flex;
      align-items:flex-end;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 18px;
    }

    .title{
      display:flex;
      flex-direction: column;
      gap: 6px;
    }

    h1{
      margin:0;
      font-size: clamp(22px, 2.4vw, 30px);
      letter-spacing: .2px;
      line-height: 1.15;
    }
    .subtitle{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(255,255,255,.80), rgba(255,255,255,.50));
      box-shadow: var(--shadow2);
      font-size: 12.5px;
      color: var(--muted);
      white-space: nowrap;
    }
    .dot{
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.1)), linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 3px rgba(47,111,235,.12);
      flex: 0 0 auto;
    }

    .grid{
      display:grid;
      grid-template-columns: 380px 1fr;
      gap: 16px;
      align-items: start;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.80), rgba(255,255,255,.56));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .card .head{
      padding: 16px 16px 12px;
      border-bottom: 1px solid rgba(30,31,34,.08);
      background: linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,.20));
    }

    .card .head .kicker{
      font-size: 12px;
      color: var(--muted);
      letter-spacing: .2px;
    }

    .card .head h2{
      margin: 6px 0 0;
      font-size: 16px;
      letter-spacing: .2px;
    }

    .card .body{
      padding: 14px 16px 16px;
    }

    .form{
      display:grid;
      gap: 12px;
    }

    .field{
      display:grid;
      gap: 6px;
    }

    .labelrow{
      display:flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
    }

    label{
      font-size: 12.5px;
      color: var(--muted);
    }

    .hint{
      font-size: 12px;
      color: var(--muted);
      opacity: .95;
    }

    .control{
      display:flex;
      gap: 10px;
      align-items: center;
    }

    input[type="number"]{
      width: 100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(30,31,34,.16);
      background: rgba(255,255,255,.82);
      outline: none;
      font-size: 14px;
      color: var(--ink);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9);
      transition: border-color .15s ease, box-shadow .15s ease, transform .08s ease;
    }
    input[type="number"]:focus{
      border-color: rgba(47,111,235,.55);
      box-shadow: 0 0 0 4px rgba(47,111,235,.14), inset 0 1px 0 rgba(255,255,255,.9);
    }

    .actions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    button{
      appearance: none;
      border: 0;
      border-radius: 999px;
      padding: 11px 14px;
      font-size: 13px;
      font-weight: 650;
      cursor: pointer;
      transition: transform .08s ease, filter .15s ease, opacity .15s ease;
      user-select: none;
    }
    button:active{ transform: translateY(1px); }

    .btn-primary{
      color: white;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 10px 18px rgba(47,111,235,.18);
    }
    .btn-ghost{
      color: var(--ink);
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(30,31,34,.14);
    }

    .summary{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 14px;
    }
    @media (max-width: 520px){
      .summary{ grid-template-columns: 1fr; }
    }
    .pill{
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(30,31,34,.10);
      background: rgba(255,255,255,.62);
    }
    .pill .t{
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 4px;
    }
    .pill .v{
      font-size: 18px;
      font-weight: 780;
      letter-spacing: .2px;
    }

    .tables{
      display:grid;
      gap: 16px;
    }

    .tablewrap{
      padding: 12px 12px 16px;
    }

    .tabletitle{
      display:flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 0 4px 10px;
    }
    .tabletitle h3{
      margin:0;
      font-size: 14px;
      letter-spacing: .2px;
    }
    .tabletitle .meta{
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
    }

    table{
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      overflow: hidden;
      border: 1px solid rgba(30,31,34,.10);
      border-radius: 16px;
      background: rgba(255,255,255,.70);
    }
    thead th{
      text-align: left;
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
      letter-spacing: .2px;
      padding: 11px 12px;
      background: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.40));
      border-bottom: 1px solid rgba(30,31,34,.08);
      position: sticky;
      top: 0;
      z-index: 1;
    }
    tbody td{
      padding: 10px 12px;
      border-bottom: 1px solid rgba(30,31,34,.06);
      vertical-align: top;
      font-size: 13.5px;
    }
    tbody tr:last-child td{ border-bottom: 0; }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12.5px;
      color: rgba(30,31,34,.82);
      line-height: 1.35;
      word-break: break-word;
    }

    .right{
      text-align: right;
      white-space: nowrap;
      font-variant-numeric: tabular-nums;
    }

    .model{
      font-weight: 750;
      letter-spacing: .2px;
    }

    .tag{
      display:inline-flex;
      align-items:center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 700;
      border: 1px solid rgba(30,31,34,.12);
      background: rgba(255,255,255,.55);
      color: var(--muted);
      margin-left: 8px;
      vertical-align: middle;
    }

    .footnote{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.55;
      padding: 0 4px;
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(30,31,34,.88);
      color: white;
      font-size: 12.5px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .15s ease, transform .15s ease;
      box-shadow: 0 10px 24px rgba(0,0,0,.20);
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-2px);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>API料金シミュレーター</h1>
        <div class="subtitle">
          input / output / 為替 / 実行回数から、<b>1リクエストあたり</b>と<b>1か月あたり（30日）</b>の料金を自動計算します。
        </div>
      </div>
      <div class="badge" title="ページを開いた時点で初期値で計算します">
        <span class="dot" aria-hidden="true"></span>
        初期値で自動計算・保存なし
      </div>
    </header>

    <div class="grid">
      <!-- Left: inputs -->
      <section class="card" aria-label="入力">
        <div class="head">
          <div class="kicker">Inputs</div>
          <h2>想定パラメータ</h2>
        </div>
        <div class="body">
          <form class="form" id="form" onsubmit="return false;">
            <div class="field">
              <div class="labelrow">
                <label for="inTok">想定 input（tokens）</label>
                <span class="hint">例: 1500</span>
              </div>
              <input id="inTok" type="number" inputmode="numeric" min="0" step="1" value="1500" />
            </div>

            <div class="field">
              <div class="labelrow">
                <label for="outTok">想定 output（tokens）</label>
                <span class="hint">例: 300</span>
              </div>
              <input id="outTok" type="number" inputmode="numeric" min="0" step="1" value="300" />
            </div>

            <div class="field">
              <div class="labelrow">
                <label for="fx">1ドル何円（JPY / USD）</label>
                <span class="hint">例: 160</span>
              </div>
              <input id="fx" type="number" inputmode="decimal" min="0" step="0.1" value="160" />
            </div>

            <div class="field">
              <div class="labelrow">
                <label for="perDay">1日の想定実行回数（requests/day）</label>
                <span class="hint">例: 1000</span>
              </div>
              <input id="perDay" type="number" inputmode="numeric" min="0" step="1" value="1000" />
            </div>

            <div class="actions">
              <button class="btn-primary" id="btnCalc" type="button">再計算</button>
              <button class="btn-ghost" id="btnCopy" type="button" title="表をTSVでコピー">表をコピー</button>
<button class="btn-ghost" id="btnCopyUrl" type="button" title="現在の入力値で開けるURLをコピー">URLをコピー</button>
              <button class="btn-ghost" id="btnReset" type="button" title="初期値に戻す">初期値に戻す</button>
            </div>

            <div class="summary" aria-label="サマリー">
              <div class="pill">
                <div class="t">1日あたり</div>
                <div class="v" id="sumDay">—</div>
              </div>
              <div class="pill">
                <div class="t">1か月（30日）あたり</div>
                <div class="v" id="sumMonth">—</div>
              </div>
            </div>
          </form>
        </div>
      </section>

      <!-- Right: tables -->
      <section class="tables" aria-label="出力">
        <div class="card">
          <div class="head">
            <div class="kicker">Table 1</div>
            <h2>1リクエストあたりの料金</h2>
          </div>
          <div class="tablewrap">
            <div class="tabletitle">
              <h3>モデル別</h3>
              <div class="meta" id="meta1">—</div>
            </div>
            <div style="overflow:auto; border-radius: 16px;">
              <table>
                <thead>
                  <tr>
                    <th style="min-width: 170px;">モデル</th>
                    <th class="right" style="min-width: 140px;">1リクエストあたり</th>
                    <th style="min-width: 520px;">計算式</th>
                  </tr>
                </thead>
                <tbody id="tbodyPerReq"></tbody>
              </table>
            </div>
            <div class="footnote">
              ※ tokens は <span class="mono">/ 1,000,000</span> で USD に換算 → 為替（円/ドル）で円換算しています。
            </div>
          </div>
        </div>

        <div class="card">
          <div class="head">
            <div class="kicker">Table 2</div>
            <h2>1か月あたりの料金（30日）</h2>
          </div>
          <div class="tablewrap">
            <div class="tabletitle">
              <h3>モデル別</h3>
              <div class="meta" id="meta2">—</div>
            </div>
            <div style="overflow:auto; border-radius: 16px;">
              <table>
                <thead>
                  <tr>
                    <th style="min-width: 170px;">モデル</th>
                    <th class="right" style="min-width: 140px;">1か月あたり</th>
                    <th style="min-width: 520px;">計算式</th>
                  </tr>
                </thead>
                <tbody id="tbodyPerMonth"></tbody>
              </table>
            </div>
            <div class="footnote">
              ※ <span class="mono">1か月 = 1日あたり × 30</span> として計算しています。
            </div>
          </div>
        </div>
      </section>
    </div>

    <div class="toast" id="toast" role="status" aria-live="polite">コピーしました</div>
  </div>

  <script>
    // ==== 設定（ユーザー例に合わせた係数） ====
    // USD / 1M tokens の単価（input, output）
    const MODELS = [
      { name: "gpt-5-nano",   inRate: 0.05, outRate: 0.40 },
      { name: "gpt-4.1-nano", inRate: 0.10, outRate: 0.40 },
      { name: "gpt-4o-mini",  inRate: 0.15, outRate: 0.60 },
      { name: "gpt-5-mini",   inRate: 0.25, outRate: 2.00 },
      { name: "gpt-4.1-mini", inRate: 0.40, outRate: 1.60 },
      { name: "gpt-5.1",      inRate: 1.25, outRate: 10.00 },
      { name: "gpt-5.2",      inRate: 1.75, outRate: 14.00 },
    ];

    const FLEX = [
      { base: "gpt-5-nano", label: "gpt-5-nano Flex", factor: 0.5 },
      { base: "gpt-5-mini", label: "gpt-5-mini Flex", factor: 0.5 },
      { base: "gpt-5.1",    label: "gpt-5.1 Flex",    factor: 0.5 },
      { base: "gpt-5.2",    label: "gpt-5.2 Flex",    factor: 0.5 },
    ];

    // ==== DOM ====
    const $ = (id) => document.getElementById(id);
    const inTok   = $("inTok");
    const outTok  = $("outTok");
    const fx      = $("fx");
    const perDay  = $("perDay");
    const tbodyPerReq   = $("tbodyPerReq");
    const tbodyPerMonth = $("tbodyPerMonth");
    const meta1 = $("meta1");
    const meta2 = $("meta2");
    const sumDay = $("sumDay");
    const sumMonth = $("sumMonth");
    const toast = $("toast");

    const btnCalc  = $("btnCalc");
    const btnReset = $("btnReset");
    const btnCopy  = $("btnCopy");
const btnCopyUrl = $("btnCopyUrl");

    // ==== Utils ====
    const clampNonNeg = (n) => (Number.isFinite(n) && n >= 0) ? n : 0;
    function applyQueryParams(){
      const sp = new URLSearchParams(location.search);
      // i: input tokens, o: output tokens, fx: JPY/USD, d: requests per day
      if (sp.has("i"))  inTok.value  = String(Math.max(0, Number(sp.get("i"))  || 0));
      if (sp.has("o"))  outTok.value = String(Math.max(0, Number(sp.get("o"))  || 0));
      if (sp.has("fx")) fx.value     = String(Math.max(0, Number(sp.get("fx")) || 0));
      if (sp.has("d"))  perDay.value = String(Math.max(0, Number(sp.get("d"))  || 0));
    }

    function buildShareUrl(){
      const url = new URL(location.href);
      url.searchParams.set("i",  String(Math.max(0, Number(inTok.value)  || 0)));
      url.searchParams.set("o",  String(Math.max(0, Number(outTok.value) || 0)));
      url.searchParams.set("fx", String(Math.max(0, Number(fx.value)     || 0)));
      url.searchParams.set("d",  String(Math.max(0, Number(perDay.value) || 0)));
      return url.toString();
    }

    btnCopyUrl.addEventListener("click", async () => {
      const shareUrl = buildShareUrl();
      try{
        await navigator.clipboard.writeText(shareUrl);
        showToast("URLをコピーしました");
      }catch(e){
        const ta = document.createElement("textarea");
        ta.value = shareUrl;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        showToast("URLをコピーしました");
      }
    });


    function formatYen(n, decimals = 4){
      // 4桁小数は「1リクエスト」用途。月額は整数に丸めたいので別で指定。
      const x = Number(n);
      if (!Number.isFinite(x)) return "—";
      return x.toLocaleString("ja-JP", { minimumFractionDigits: decimals, maximumFractionDigits: decimals }) + " 円";
    }

    function formatYenInt(n){
      const x = Number(n);
      if (!Number.isFinite(x)) return "—";
      return Math.round(x).toLocaleString("ja-JP") + " 円";
    }

    function showToast(text){
      toast.textContent = text;
      toast.classList.add("show");
      window.clearTimeout(showToast._t);
      showToast._t = window.setTimeout(() => toast.classList.remove("show"), 1200);
    }

    function moneyPerRequestJPY(inRate, outRate, inTokens, outTokens, fxJPY){
      // (inRate * inTokens / 1e6 + outRate * outTokens / 1e6) USD  → * fxJPY
      const usd = (inRate * inTokens + outRate * outTokens) / 1_000_000;
      return usd * fxJPY;
    }

    function formulaText(inRate, outRate, fxJPY, inTokens, outTokens){
      const fxStr = trimNum(fxJPY);
      return `${trimNum(inRate)} × ${fxStr} × ${trimNum(inTokens)} / 1,000,000 + ${trimNum(outRate)} × ${fxStr} × ${trimNum(outTokens)} / 1,000,000`;
    }

    function trimNum(n){
      // 0.40 → 0.40 を維持したいので固定小数2を基本に
      // ただし 160.0 → 160 などはスッキリ
      const x = Number(n);
      if (!Number.isFinite(x)) return String(n);
      // 小数がほぼ整数なら整数表示
      if (Math.abs(x - Math.round(x)) < 1e-9) return String(Math.round(x));
      // それ以外は最大2桁（fxは0.1刻み想定）
      return x.toFixed(2).replace(/0+$/,'').replace(/\.$/,'');
    }

    function render(){
      const inT = clampNonNeg(parseFloat(inTok.value));
      const outT = clampNonNeg(parseFloat(outTok.value));
      const fxJ = clampNonNeg(parseFloat(fx.value));
      const dayN = clampNonNeg(parseFloat(perDay.value));
      const daysInMonth = 30;

      meta1.textContent = `input=${trimNum(inT)} / output=${trimNum(outT)} / 為替=${trimNum(fxJ)} /day=${trimNum(dayN)}`;
      meta2.textContent = `1か月=30日（day=${trimNum(dayN)}）`;

      // Build per-request table rows
      tbodyPerReq.innerHTML = "";
      tbodyPerMonth.innerHTML = "";

      // For summary: use the cheapest? ここでは「全モデルのうち最小/最大」等ではなく、
      // “gpt-4o-mini” を代表として出すと恣意的なので、平均も微妙。
      // 代わりに「選択モデル」を作る案もあるが要件外なので、ここでは “gpt-4o-mini” を代表モデルとして表示しない。
      // → サマリーは “gpt-4o-mini” ではなく「gpt-5-nano」を基準に表示（例があるため）。
      const baseForSummary = MODELS[0];

      // Render base models
      const rows = [];
      for (const m of MODELS){
        const perReq = moneyPerRequestJPY(m.inRate, m.outRate, inT, outT, fxJ);

        rows.push({
          model: m.name,
          formula: formulaText(m.inRate, m.outRate, fxJ, inT, outT),
          perReq
        });
      }

      // Render flex rows (half price, show tag)
      for (const f of FLEX){
        const base = MODELS.find(x => x.name === f.base);
        if (!base) continue;
        const perReqBase = moneyPerRequestJPY(base.inRate, base.outRate, inT, outT, fxJ);
        rows.push({
          model: f.label,
          formula: `${formatYen(perReqBase, 4)} → 半額`,
          perReq: perReqBase * f.factor,
          isFlex: true
        });
      }

      // For month table use same order as rows
      let tsvLines = [];
      tsvLines.push(["[1リクエストあたり]","モデル","計算式","金額(JPY)"].join("\t"));

      for (const r of rows){
        const tr = document.createElement("tr");

        const tdModel = document.createElement("td");
        tdModel.innerHTML = `<span class="model">${escapeHtml(r.model)}</span>${r.isFlex ? `<span class="tag">半額</span>` : ""}`;

        const tdFormula = document.createElement("td");
        tdFormula.className = "mono";
        tdFormula.textContent = r.formula;

        const tdMoney = document.createElement("td");
        tdMoney.className = "right";
        tdMoney.textContent = formatYen(r.perReq, 4);

        tr.appendChild(tdModel);
        tr.appendChild(tdMoney);
        tr.appendChild(tdFormula);
        tbodyPerReq.appendChild(tr);

        tsvLines.push(["", r.model, r.formula, r.perReq].join("\t"));
      }

      tsvLines.push("");
      tsvLines.push(["[1か月あたり(30日)]","モデル","計算式","金額(JPY)"].join("\t"));

      for (const r of rows){
        const perMonth = r.perReq * dayN * daysInMonth;

        const tr = document.createElement("tr");

        const tdModel = document.createElement("td");
        tdModel.innerHTML = `<span class="model">${escapeHtml(r.model)}</span>${r.isFlex ? `<span class="tag">半額</span>` : ""}`;

        const tdFormula = document.createElement("td");
        tdFormula.className = "mono";

        // 月額は例の形： (式) × day × 30
        if (r.isFlex){
          // Flexは「半額」表示に寄せる（元の式をそのまま書くと長いので）
          tdFormula.textContent = `(${rows.find(x => x.model === r.model)?.formula ?? r.formula}) × ${trimNum(dayN)} × 30`;
        } else {
          tdFormula.textContent = `(${r.formula}) × ${trimNum(dayN)} × 30`;
        }

        const tdMoney = document.createElement("td");
        tdMoney.className = "right";
        tdMoney.textContent = formatYenInt(perMonth);

        tr.appendChild(tdModel);
        tr.appendChild(tdMoney);
        tr.appendChild(tdFormula);
        tbodyPerMonth.appendChild(tr);

        tsvLines.push(["", r.model, tdFormula.textContent, perMonth].join("\t"));
      }

      // Summary (use first base model as a neutral baseline)
      const basePerReq = moneyPerRequestJPY(baseForSummary.inRate, baseForSummary.outRate, inT, outT, fxJ);
      const basePerDay = basePerReq * dayN;
      const basePerMonth = basePerDay * daysInMonth;

      sumDay.textContent = `${formatYenInt(basePerDay)}（${baseForSummary.name}）`;
      sumMonth.textContent = `${formatYenInt(basePerMonth)}（${baseForSummary.name}）`;

      // store TSV into button dataset (no localStorage)
      btnCopy.dataset.tsv = tsvLines.join("\n");
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#39;");
    }

    // ==== Events ====
    function wireAutoCalc(){
      const inputs = [inTok, outTok, fx, perDay];
      for (const el of inputs){
        el.addEventListener("input", render);
        el.addEventListener("change", render);
      }
    }

    btnCalc.addEventListener("click", render);

    btnReset.addEventListener("click", () => {
      inTok.value = 1500;
      outTok.value = 300;
      fx.value = 160;
      perDay.value = 1000;
      render();
      showToast("初期値に戻しました");
    });

    btnCopy.addEventListener("click", async () => {
      const tsv = btnCopy.dataset.tsv || "";
      try{
        await navigator.clipboard.writeText(tsv);
        showToast("表（TSV）をコピーしました");
      }catch(e){
        // Fallback
        const ta = document.createElement("textarea");
        ta.value = tsv;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        showToast("表（TSV）をコピーしました");
      }
    });

    // ==== Init ====
    wireAutoCalc();
applyQueryParams();
    render(); // 初期値で即表示
  </script>
</body>
</html>
